<!-- modals.html -->

<!-- Add Seat Modal -->
<div class="modal fade" id="addSeatModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <form method="post" action="{{ url_for('admin_add_seat') }}">
        <div class="modal-header">
          <h5 class="modal-title">‚ûï Create New Seat(s)</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Type</label>
            <select name="type" class="form-select">
              {% for t in seat_types %}<option>{{ t }}</option>{% endfor %}
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Price</label>
            <input type="number" name="price" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Location</label>
            <select name="location" class="form-select">
              {% for city, halls in grouped_locations.items() %}
                <optgroup label="{{ city }}">
                  {% for hall in halls %}
                    <option value="{{ hall }}">{{ hall }}</option>
                  {% endfor %}
                </optgroup>
              {% endfor %}
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Number of Seats</label>
            <input type="number" name="count" class="form-control" value="1" min="1">
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-success">Create</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Update Seat Modal -->
<div class="modal fade" id="seatModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <form method="post" action="{{ url_for('admin_update_seat') }}">
        <div class="modal-header">
          <h5 class="modal-title">Update Seat</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" name="seat_id" id="seatId">
          <div class="mb-3">
            <label class="form-label">Type</label>
            <select name="type" id="seatTypeModal" class="form-select">
              {% for t in seat_types %}<option>{{ t }}</option>{% endfor %}
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Price</label>
            <input type="number" name="price" id="seatPrice" class="form-control">
          </div>
          <div class="mb-3">
            <label class="form-label">Location</label>
            <select name="location" id="seatLocationModal" class="form-select">
              {% for city, halls in grouped_locations.items() %}
                <optgroup label="{{ city }}">
                  {% for hall in halls %}
                    <option value="{{ hall }}">{{ hall }}</option>
                  {% endfor %}
                </optgroup>
              {% endfor %}
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary">Save</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Help Modal -->
<div class="modal fade" id="helpModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-info text-white">
        <h5 class="modal-title">‚ùì Help & Support</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p>Welcome to the <b>Admin Dashboard</b>.</p>
        <ul>
          <li>Use the navigation bar to manage <b>Seats</b>, <b>Bookings</b>, and <b>Users</b>.</li>
          <li>Right-click on a seat for quick actions (block/unblock/unbook).</li>
          <li>Filter data using the filters provided above tables.</li>
        </ul>
        <hr>
        <p class="mb-1">For any issue or queries, contact:</p>
        <p class="fw-bold mb-0">üìß support@library.com</p>
        <p class="fw-bold">üìû +91 98765 43210</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- JS for seat modal + right-click actions -->
<script>
$(document).on("click", ".seat", function() {
  $("#seatId").val($(this).data("id"));
  $("#seatTypeModal").val($(this).data("type"));
  $("#seatPrice").val($(this).data("price"));
  $("#seatLocationModal").val($(this).data("location"));
  $("#seatModal").modal("show");
});

$(document).on("contextmenu", ".seat", function(e) {
  e.preventDefault();
  const seatId = $(this).data("id");
  const action = prompt("Enter action: block / unblock / unbook");
  if (!action) return;
  $.ajax({
    url: "/admin_action",
    type: "POST",
    contentType: "application/json",
    data: JSON.stringify({ seat_id: seatId, action: action }),
    success: function(res) {
      if (res.success) location.reload();
      else alert("Action failed");
    }
  });
});
</script>
