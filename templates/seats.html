{% extends "base.html" %}

{% block head %}
<style>
  body { background-color: #f8f9fa; font-family: Arial, sans-serif; }
  .main-container { max-width: 1200px; margin: auto; }
  .hall-container { display: flex; justify-content: space-between; margin-bottom: 40px; flex-wrap: wrap; gap: 20px; }
  .hall { flex: 1; background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.08); min-width: 300px; }
  .hall h4 { text-align: center; margin-bottom: 20px; font-weight: bold; letter-spacing: 1px; }

  .row-layout { display: flex; align-items: center; justify-content: center; margin-bottom: 25px; flex-wrap: wrap; }
  .seat-row { display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px; justify-items: center; }

  .seat { width: 55px; height: 55px; display: flex; align-items: center; justify-content: center; border-radius: 8px; font-size: 14px; font-weight: bold; color: white; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.15); }
  .seat:hover { transform: scale(1.05); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
  .booked { background: #dc3545 !important; cursor: not-allowed !important; pointer-events: none; opacity: 0.7; }
  .passage { width: 40px; }
  .wall { font-size: 24px; color: #343a40; margin-left: 10px; margin-right: 10px; width: 30px; text-align: center; }

  /* Seat type colors */
  .deluxe { background: #007bff; }
  .premium { background: #28a745; }
  .unreserved { background: #ffc107; color: black; }
  .hr { background: #fd7e14; }

  .facing { font-size: 20px; font-weight: bold; margin: 0 10px; color: #555; }
  .row-label { font-weight: bold; color: #555; width: 60px; text-align: right; }

  /* Legend */
  .legend { display: flex; justify-content: center; flex-wrap: wrap; gap: 25px; margin-bottom: 30px; padding: 15px; background: #f1f1f1; border-radius: 10px; }
  .legend div { display: flex; align-items: center; font-weight: bold; }
  .legend a, .legend span { display: inline-block; width: 25px; height: 25px; margin-right: 8px; border-radius: 5px; cursor: pointer; transition: transform 0.2s; }
  .legend a:hover { transform: scale(1.1); }
  .hidden { display: none; }
</style>
{% endblock %}

{% block content %}
<h2 class="fw-bold mb-4 text-center">ðŸŽ“ Exam Hall Seat Booking</h2>
<p class="text-center text-muted">Select a location to view the seat layout and book your seat.</p>

<div class="mb-5 d-flex justify-content-center">
  <div class="form-group w-50">
    <label for="locationSelect" class="form-label fw-bold">Select Location:</label>
    <select class="form-select" id="locationSelect" onchange="showLocationLayout()">
      <option value="">-- Choose a Location --</option>
      <option value="pune">Pune Center</option>
      <option value="mumbai">Mumbai Center</option>
    </select>
  </div>
</div>

<div class="legend mb-4">
  <div><a href="#" class="deluxe" onclick="showSeatDetails('Deluxe')"></a> Deluxe</div>
  <div><a href="#" class="premium" onclick="showSeatDetails('Premium')"></a> Premium</div>
  <div><a href="#" class="unreserved" onclick="showSeatDetails('Unreserved')"></a> Unreserved</div>
  <div><a href="#" class="hr" onclick="showSeatDetails('HR')"></a> HR</div>
  <div><span class="booked"></span> Booked</div>
</div>

<div id="puneLayout" class="main-container hidden">
  <div class="hall-container">
    <div class="hall">
      <h4 class="text-primary">Pune Hall 1 (Seats 1-100)</h4>
      <div class="row-layout"><span class="facing">â—€</span><div class="seat-row" id="pune-hall1-a"></div><div class="wall">ðŸ§±</div><span class="row-label">Row A</span></div>
      <div class="row-layout"><span class="facing">â–¶</span><div class="seat-row" id="pune-hall1-b"></div><div class="passage"></div><div class="seat-row" id="pune-hall1-c"></div><div class="wall">ðŸ§±</div><span class="row-label">Row B</span></div>
      <div class="row-layout"><span class="me-2">Row D</span><div class="seat-row" id="pune-hall1-d"></div><span class="facing">â–¶</span><div class="wall">ðŸ§±</div><span class="row-label">Row D</span></div>
    </div>
    <div class="hall">
      <h4 class="text-success">Pune Hall 2 (Seats 101-200)</h4>
      <div class="row-layout"><span class="facing">â—€</span><div class="seat-row" id="pune-hall2-a"></div><div class="wall">ðŸ§±</div><span class="row-label">Row A</span></div>
      <div class="row-layout"><span class="facing">â–¶</span><div class="seat-row" id="pune-hall2-b"></div><div class="passage"></div><div class="seat-row" id="pune-hall2-c"></div><div class="wall">ðŸ§±</div><span class="row-label">Row B</span></div>
      <div class="row-layout"><span class="me-2">Row D</span><div class="seat-row" id="pune-hall2-d"></div><span class="facing">â–¶</span><div class="wall">ðŸ§±</div><span class="row-label">Row D</span></div>
    </div>
  </div>
  <div class="hall-container">
    <div class="hall mx-auto" style="min-width: 600px;">
      <h4 class="text-info">Pune Hall 3 (Seats 201-300)</h4>
      <div class="row-layout"><span class="facing">â—€</span><div class="seat-row" id="pune-hall3-a"></div><div class="wall">ðŸ§±</div><span class="row-label">Row A</span></div>
      <div class="row-layout"><span class="facing">â–¶</span><div class="seat-row" id="pune-hall3-b"></div><div class="passage"></div><div class="seat-row" id="pune-hall3-c"></div><div class="wall">ðŸ§±</div><span class="row-label">Row B</span></div>
      <div class="row-layout"><span class="me-2">Row D</span><div class="seat-row" id="pune-hall3-d"></div><span class="facing">â–¶</span><div class="wall">ðŸ§±</div><span class="row-label">Row D</span></div>
    </div>
  </div>
</div>

<div id="mumbaiLayout" class="main-container hidden">
  <div class="hall-container">
    <div class="hall">
      <h4 class="text-primary">Mumbai Hall 1 (Seats 1-100)</h4>
      <div class="row-layout"><span class="facing">â—€</span><div class="seat-row" id="mumbai-hall1-a"></div><div class="wall">ðŸ§±</div><span class="row-label">Row A</span></div>
      <div class="row-layout"><span class="facing">â–¶</span><div class="seat-row" id="mumbai-hall1-b"></div><div class="passage"></div><div class="seat-row" id="mumbai-hall1-c"></div><div class="wall">ðŸ§±</div><span class="row-label">Row B</span></div>
      <div class="row-layout"><span class="me-2">Row D</span><div class="seat-row" id="mumbai-hall1-d"></div><span class="facing">â–¶</span><div class="wall">ðŸ§±</div><span class="row-label">Row D</span></div>
    </div>
    <div class="hall">
      <h4 class="text-success">Mumbai Hall 2 (Seats 101-200)</h4>
      <div class="row-layout"><span class="facing">â—€</span><div class="seat-row" id="mumbai-hall2-a"></div><div class="wall">ðŸ§±</div><span class="row-label">Row A</span></div>
      <div class="row-layout"><span class="facing">â–¶</span><div class="seat-row" id="mumbai-hall2-b"></div><div class="passage"></div><div class="seat-row" id="mumbai-hall2-c"></div><div class="wall">ðŸ§±</div><span class="row-label">Row B</span></div>
      <div class="row-layout"><span class="me-2">Row D</span><div class="seat-row" id="mumbai-hall2-d"></div><span class="facing">â–¶</span><div class="wall">ðŸ§±</div><span class="row-label">Row D</span></div>
    </div>
  </div>
  <div class="hall-container">
    <div class="hall mx-auto" style="min-width: 600px;">
      <h4 class="text-info">Mumbai Hall 3 (Seats 201-300)</h4>
      <div class="row-layout"><span class="facing">â—€</span><div class="seat-row" id="mumbai-hall3-a"></div><div class="wall">ðŸ§±</div><span class="row-label">Row A</span></div>
      <div class="row-layout"><span class="facing">â–¶</span><div class="seat-row" id="mumbai-hall3-b"></div><div class="passage"></div><div class="seat-row" id="mumbai-hall3-c"></div><div class="wall">ðŸ§±</div><span class="row-label">Row B</span></div>
      <div class="row-layout"><span class="me-2">Row D</span><div class="seat-row" id="mumbai-hall3-d"></div><span class="facing">â–¶</span><div class="wall">ðŸ§±</div><span class="row-label">Row D</span></div>
    </div>
  </div>
</div>

<div class="modal fade" id="bookSeatModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <form id="bookingForm">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title">ðŸŽŸ Book Seat</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body row g-3">
          <div class="col-md-4">
            <label class="form-label">Seat</label>
            <input type="text" id="modalSeatName" class="form-control" disabled>
          </div>
          <div class="col-md-4">
            <label class="form-label">Type</label>
            <input type="text" id="modalSeatType" class="form-control" disabled>
          </div>
          <div class="col-md-4">
            <label class="form-label">Price</label>
            <input type="number" id="modalSeatPrice" class="form-control" disabled>
          </div>
          <div class="col-md-6">
            <label class="form-label">Your Name</label>
            <input type="text" id="userName" class="form-control" required>
          </div>
          <div class="col-md-6">
            <label class="form-label">Mobile</label>
            <input type="text" id="userMobile" class="form-control">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-success">âœ… Confirm Booking</button>
        </div>
      </div>
    </form>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  const seatPrices = { Deluxe: 1000, Premium: 800, Unreserved: 500, HR: 300 };
  let currentSeat = null;

  function generateSeats(containerId, hallName, rowLabel, start, count, type) {
    let container = document.getElementById(containerId);
    if (!container) return;
    container.innerHTML = '';
    for (let i = 0; i < count; i++) {
      let seatNum = start + i;
      let seat = document.createElement("div");
      seat.className = "seat " + type.toLowerCase();
      seat.innerText = seatNum;
      seat.title = `Seat ${hallName}-${rowLabel}${i+1}\nType: ${type}\nPrice: â‚¹${seatPrices[type]}`;
      seat.setAttribute("data-bs-toggle", "modal");
      seat.setAttribute("data-bs-target", "#bookSeatModal");

      seat.onclick = function() {
        if (seat.classList.contains("booked")) return;
        currentSeat = seat;
        document.getElementById("modalSeatName").value = `${hallName}-${rowLabel}${i+1}`;
        document.getElementById("modalSeatType").value = type;
        document.getElementById("modalSeatPrice").value = seatPrices[type];
      };
      container.appendChild(seat);
    }
  }

  function showSeatDetails(type) {
    const price = seatPrices[type];
    let description = "";
    switch (type) {
      case "Deluxe":
        description = "The most spacious and comfortable seats available. Ideal for those who prefer extra legroom and a quiet environment.";
        break;
      case "Premium":
        description = "A great balance of comfort and value. These seats offer a pleasant experience with good sightlines to the board.";
        break;
      case "Unreserved":
        description = "Standard seating with a good view. A solid choice for a regular exam experience.";
        break;
      case "HR":
        description = "These seats are designated for high-risk students and offer a private, isolated space. (Note: These seats are often reserved for special cases and require prior approval).";
        break;
    }
    alert(`Seat Type: ${type}\nPrice: â‚¹${price}\n\nDescription: ${description}`);
  }

  function showLocationLayout() {
    const location = document.getElementById('locationSelect').value;
    document.getElementById('puneLayout').classList.add('hidden');
    document.getElementById('mumbaiLayout').classList.add('hidden');
    if (location === 'pune') {
      document.getElementById('puneLayout').classList.remove('hidden');
      generatePuneSeats();
    } else if (location === 'mumbai') {
      document.getElementById('mumbaiLayout').classList.remove('hidden');
      generateMumbaiSeats();
    }
  }

  function generatePuneSeats() {
    // Pune Hall 1 (100 seats)
    generateSeats("pune-hall1-a", "P-H1", "A", 1, 20, "Deluxe");
    generateSeats("pune-hall1-b", "P-H1", "B", 21, 20, "Premium");
    generateSeats("pune-hall1-c", "P-H1", "C", 41, 20, "Unreserved");
    generateSeats("pune-hall1-d", "P-H1", "D", 61, 20, "HR");

    // Pune Hall 2 (100 seats)
    generateSeats("pune-hall2-a", "P-H2", "A", 81, 20, "Deluxe");
    generateSeats("pune-hall2-b", "P-H2", "B", 101, 20, "Premium");
    generateSeats("pune-hall2-c", "P-H2", "C", 121, 20, "Unreserved");
    generateSeats("pune-hall2-d", "P-H2", "D", 141, 20, "HR");

    // Pune Hall 3 (100 seats)
    generateSeats("pune-hall3-a", "P-H3", "A", 161, 20, "Deluxe");
    generateSeats("pune-hall3-b", "P-H3", "B", 181, 20, "Premium");
    generateSeats("pune-hall3-c", "P-H3", "C", 201, 20, "Unreserved");
    generateSeats("pune-hall3-d", "P-H3", "D", 221, 20, "HR");
  }

  function generateMumbaiSeats() {
    // Mumbai Hall 1 (100 seats)
    generateSeats("mumbai-hall1-a", "M-H1", "A", 1, 20, "Deluxe");
    generateSeats("mumbai-hall1-b", "M-H1", "B", 21, 20, "Premium");
    generateSeats("mumbai-hall1-c", "M-H1", "C", 41, 20, "Unreserved");
    generateSeats("mumbai-hall1-d", "M-H1", "D", 61, 20, "HR");

    // Mumbai Hall 2 (100 seats)
    generateSeats("mumbai-hall2-a", "M-H2", "A", 81, 20, "Deluxe");
    generateSeats("mumbai-hall2-b", "M-H2", "B", 101, 20, "Premium");
    generateSeats("mumbai-hall2-c", "M-H2", "C", 121, 20, "Unreserved");
    generateSeats("mumbai-hall2-d", "M-H2", "D", 141, 20, "HR");

    // Mumbai Hall 3 (100 seats)
    generateSeats("mumbai-hall3-a", "M-H3", "A", 161, 20, "Deluxe");
    generateSeats("mumbai-hall3-b", "M-H3", "B", 181, 20, "Premium");
    generateSeats("mumbai-hall3-c", "M-H3", "C", 201, 20, "Unreserved");
    generateSeats("mumbai-hall3-d", "M-H3", "D", 221, 20, "HR");
  }

  // Handle booking form submit
  document.getElementById("bookingForm").addEventListener("submit", function(e) {
    e.preventDefault();
    if (currentSeat) {
      currentSeat.classList.add("booked");
      currentSeat.removeAttribute("data-bs-toggle");
      currentSeat.removeAttribute("data-bs-target");
      currentSeat.title += "\n(BOOKED)";
      currentSeat = null;
    }
    let modal = bootstrap.Modal.getInstance(document.getElementById('bookSeatModal'));
    modal.hide();
    this.reset();
  });
</script>
{% endblock %}
